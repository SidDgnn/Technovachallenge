<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Tableau de board Tech Nova Challenge</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
  <link rel="stylesheet" href="./style.css">
  <style>

    .form-container {
      padding-top: 50px;
      padding-left: 200px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 800px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .column-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      width: 100%;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-size: 0.9rem;
      color: #4B07A3;
    }

    .form-group input {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .form-group input:focus {
      border-color: #007BFF;
      outline: none;
      box-shadow: 0 0 4px rgba(0, 123, 255, 0.2);
    }

    .form-group.large input {
      height: 125px;
    }

    .submit-btn {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      color: #fff;
      background-color: #4B07A3;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      align-self: center;
    }

    .submit-btn:hover {
      background-color: #0056b3;
    }
#presentation{
    background-color: white;
}
    @media (max-width: 768px) {
      .column-container {
        grid-template-columns: 1fr;
      }

      .form-container {
        padding: 15px;
      }

      .submit-btn {
        width: 50%;
      }
    }
  </style>
</head>
<body>
<!-- partial:index.partial.html -->
<div class="app-container">
  <div class="sidebar" id="hiddenSection">
    <div class="sidebar-header">
      <div class="app-icon">
        <a href="index.html">
          <button id="close-sidebar">
          <img src="images/logo (1).png" alt="Tech Nova Challenge" style="height: 15vh; width: 150px; cursor: pointer;" >
          </button>
        </a>
      </div>
    </div>
    <ul class="sidebar-list">
      <li class="sidebar-list-item">
        <a href="index.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          <span>Accueil</span>
        </a>
      </li>
      <li class="sidebar-list-item active">
        <a href="soumission.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-upload"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
          <span>Soumission</span>
        </a>
      </li>
      <li class="sidebar-list-item">
        <a href="dates.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          <span>Dates clés</span>
        </a>
      </li>
      <li class="sidebar-list-item">
        <a href="faq.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-help-circle"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 1 1 5.91 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12" y2="17"/></svg>
          <span>F.A.Q</span>
        </a>
      </li>
      <li class="sidebar-list-item">
        <a href="contact.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-phone"><path d="M22 16.92V21a2 2 0 0 1-2.18 2 19.39 19.39 0 0 1-8.36-3.4A19.39 19.39 0 0 1 2 4.18 2 2 0 0 1 4 2h4.09a2 2 0 0 1 2 1.72 12.6 12.6 0 0 0 .57 2.52 2 2 0 0 1-.45 2L8.91 10.09a16 16 0 0 0 6 6l2.83-1.41a2 2 0 0 1 2 .45 12.6 12.6 0 0 0 2.52.57 2 2 0 0 1 1.72 2.01z"/></svg>
          <span>Contact</span>
        </a>
      </li>
      <li class="sidebar-list-item">
        <a href="deconnexion.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          <span>Déconnexion</span>
        </a>
      </li>
    </ul>
    
  </div>
  <div class="app-content">
    <div class="app-content-header">
      <h1 class="app-content-headerText">Tech Nova Challenge</h1>
      <button id="toggleButton" title="Menus">
        <img src="images/menu.jpg" class="moon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="24" height="24" viewBox="0 0 24 24"          ">
        </img>
      </button>
    </div>
    <div class="app-content-body">
      <h1 style="text-align: center; padding: 3rem; color:  #4B07A3;" >Soumettez votre projet pour participer 
        au Tech Nova Challenge !</h1>
      <p style="text-align: center; line-height: 30px; padding-left: 4rem; padding-right: 4rem;color: rgba(255, 255, 255, 0.916);" >
        Veuillez compléter les informations et télécharger les documents requis
        pour que votre projet soit pris en compte dans le concours.
        Assurez-vous que tous les fichiers sont dans les formats acceptés
        (.pdf, .docx, .ppt) et que vos fichiers portent le nom de votre équipe. <i style="color:  #4B07A3; font-weight: bold;">Soyez rigoureux sur la soumission
      des informations car une fois soumis,vous n'aurez plus la possibilité de modifier.</i></p>
    </div>

    <div class="form-container">
      <form id="submissionForm" method="POST" enctype="multipart/form-data">
        <div class="column-container">
          <div class="column">
            <div class="form-group">
              <label for="projectTitle">Titre du projet</label>
              <input type="text" id="projectTitle" name="projectTitle" placeholder="Entrer le titre du projet" required>
            </div>
            <div class="form-group large">
              <label for="summary">Résumé du projet</label>
              <input type="text" id="summary" name="summary" placeholder="Saisissez un résumé de votre projet" required>
            </div>
          </div>
          <div class="column">
            <div class="form-group">
              <label for="plan">Plan du projet</label>
              <input type="text" id="plan" name="plan" placeholder="Entrez les grandes étapes de réalisation" required>
            </div>
            <div class="form-group">
              <label for="budget">Budget prévisionnel</label>
              <input type="text" id="budget" name="budget" placeholder="Budget pour réaliser votre projet" required>
            </div>
            <div class="form-group">
              <label for="presentationFile">Présentation PowerPoint</label>
              <input type="file" id="presentationFile" name="presentationFile" required>
            </div>
          </div>
        </div>
        <button type="submit" class="submit-btn">Soumettre</button>
      </form>
      
          <p style="text-align: center; line-height: 25px; padding-left: 1rem; padding-right: 2rem;color: rgba(255, 255, 255, 0.916); ">
        <i>   Une fois votre projet soumis, vous recevrez un email de confirmation.
 Vous pourrez aussi suivre l’avancement de l’évaluation depuis cette section.
       </i> 
          </p>
      </div>
  </div>
</div>
<!-- partial -->
<script>
  document.addEventListener('DOMContentLoaded', async () => {
  const token = localStorage.getItem('token'); // Récupérer le token JWT
  const form = document.getElementById('submissionForm');
  const inputs = form.querySelectorAll('input');
  const submitButton = form.querySelector('.submit-btn');

  try {
    const response = await fetch('https://6c39-197-234-221-133.ngrok-free.app/api/check-submission', {
      method: 'GET',
      headers: {
        Authorization: `Bearer ${token}`, // Inclure le token JWT dans l'en-tête
      },
    });

    if (response.ok) {
      const result = await response.json();

      if (result.submissionExists) {
        // Si la soumission existe, désactivez les champs et cachez le bouton
        inputs.forEach(input => (input.disabled = true));
        submitButton.style.display = 'none';
        alert('Vous avez déjà soumis un projet. Les champs sont désactivés.');
      }
    } else {
      console.warn('Impossible de vérifier la soumission.');
    }
  } catch (err) {
    console.error('Erreur lors de la vérification de la soumission:', err);
  }
});

document.querySelector('form').addEventListener('submit', async (e) => {
  e.preventDefault();

  const formData = new FormData(e.target);
  const token = localStorage.getItem('token'); // Récupérer le token depuis le localStorage

  try {
    const response = await fetch('http://localhost:5000/api/submit', {
      method: 'POST',
      headers: {
        Authorization: `Bearer ${token}`, // Inclure le token dans l'en-tête
      },
      body: formData, // Envoyer les données du formulaire
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error || 'Erreur lors de la soumission du projet.');
    }

    const result = await response.json();
    alert(result.message || 'Projet soumis avec succès !');

    // Désactiver les champs après la soumission et masquer le bouton
    const inputs = document.querySelectorAll('input');
    inputs.forEach(input => (input.disabled = true));
    const submitButton = document.querySelector('.submit-btn');
    submitButton.style.display = 'none';

    // Redirection ou rafraîchissement de la page (optionnel)
    window.location.href = 'soumission.html';
  } catch (err) {
    console.error('Erreur:', err);
    alert('Une erreur est produite. Veuillez réessayer plus tard.');
  }
});

</script>

<script src="script.js"></script>
</body>
</html>
